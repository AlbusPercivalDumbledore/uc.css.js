/* use scrollbars instead of scroll buttons on most arrowscrollboxes */
menupopup::part(arrowscrollbox-scrollbox) {
    overflow-y: auto !important;
    padding-top: 0 !important;
    margin-block: 0 !important;
    scroll-behavior: smooth !important;
}

#BMB_bookmarksPopup::part(arrowscrollbox),
#BMB_bookmarksPopup menupopup::part(arrowscrollbox),
#BMB_bookmarksPopup menupopup[placespopup="true"]::part(arrowscrollbox) {
    padding-block: 4px;
}

#BMB_bookmarksPopup::part(arrowcontent) {
    padding-block: 0;
}

#BMB_bookmarksPopup menupopup[placespopup="true"]::part(innerbox) {
    margin-top: 0;
    border: none;
}

#BMB_bookmarksPopup .panel-subview-footer-button {
    margin-bottom: unset;
}

.panel-subview-footer-button {
    margin-bottom: 4px;
}

/* panel width */
#customizationui-widget-multiview panelview:not([extension]) {
    width: unset;
    min-width: 23em;
}

:where(#customizationui-widget-multiview) panelview:not([extension]) {
    max-width: 18vw;
}

/* focused buttons to look like hovered buttons */
panelview
    :is(.toolbarbutton-1, toolbarbutton.subviewbutton, .navigable.subviewbutton):not([disabled], [open]):focus,
.widget-overflow-list .toolbarbutton-1:not([disabled], [open]):focus,
.toolbaritem-combined-buttons:is(:not([cui-areatype="toolbar"]), [overflowedItem="true"])
    > toolbarbutton:not([disabled], [open]):focus {
    background-color: var(--panelview-toolbarbutton-hover-bgcolor);
    color: var(--panelview-toolbarbutton-hover-color);
}

panelview
    :is(.toolbarbutton-1, toolbarbutton.subviewbutton, .navigable.subviewbutton):not([disabled], [open]):focus:active,
.widget-overflow-list .toolbarbutton-1:not([disabled], [open]):focus:active,
.toolbaritem-combined-buttons:is(:not([cui-areatype="toolbar"]), [overflowedItem="true"])
    > toolbarbutton:not([disabled], [open]):focus:active {
    background-color: var(--panelview-toolbarbutton-active-bgcolor);
    color: var(--panelview-toolbarbutton-active-color);
}

menupopup::part(drop-indicator-bar) {
    margin-block: -14px;
}

menupopup::part(drop-indicator) {
    pointer-events: none;
    background: none;
    list-style-image: url(chrome://browser/skin/customizableui/menu-arrow.svg);
    -moz-context-properties: fill, fill-opacity, stroke, stroke-opacity;
    fill: var(--lwt-toolbarbutton-icon-fill, currentColor);
    height: 28px;
    max-width: 28px;
    padding-block: 6px;
    padding-inline: 0 12px;
}

/* padding for proton context menus */
:is(#back-button, #forward-button, #viewButton) > menupopup::part(arrowscrollbox),
:is(.popup-notification-dropmarker, #main-menubar, #PlacesToolbar, #places)
    menupopup::part(arrowscrollbox),
:is(#toolbar-context-menu, #tabContextMenu, #contentAreaContextMenu, #backForwardMenu, #placesContext, #pageActionContextMenu, .search-one-offs-context-menu, #SyncedTabsSidebarContext, .textbox-contextmenu, #customizationPanelItemContextMenu, #customizationPaletteItemContextMenu, #customization-toolbar-menu, #new-tab-button-popup, #new-tab-button, #downloadsContextMenu, menupopup[menu-api], #ContentSelectDropdown, menupopup.in-menulist, .new-tab-popup, #openHandlerPopup)::part(arrowscrollbox),
:is(#back-button, #forward-button, #viewButton) > menupopup menupopup::part(arrowscrollbox),
:is(.popup-notification-dropmarker, #main-menubar, #PlacesToolbar, #places)
    menupopup
    menupopup::part(arrowscrollbox),
:is(#toolbar-context-menu, #tabContextMenu, #contentAreaContextMenu, #backForwardMenu, #placesContext, #pageActionContextMenu, .search-one-offs-context-menu, #SyncedTabsSidebarContext, .textbox-contextmenu, #customizationPanelItemContextMenu, #customizationPaletteItemContextMenu, #customization-toolbar-menu, #new-tab-button-popup, #new-tab-button, #downloadsContextMenu, menupopup[menu-api], #ContentSelectDropdown, menupopup.in-menulist, .new-tab-popup, #openHandlerPopup)
    menupopup::part(arrowscrollbox) {
    padding: var(--menupopup-inner-padding) !important;
}

@-moz-document url-prefix("chrome://devtools/content/")
{
    menupopup::part(arrowscrollbox) {
        padding: var(--menupopup-inner-padding) !important;
    }
}

#ContentSelectDropdown > menupopup::part(arrowscrollbox) {
    padding: var(--menupopup-inner-padding) !important;
}

/* hide scroll buttons â€” doesn't seem to work anymore. put this in your regular userChrome.css instead:
link[href="chrome://global/skin/arrowscrollbox.css"] ~ :is(#scrollbutton-up, #scrollbutton-down) {
        visibility: collapse;
} */
.menupopup-arrowscrollbox::part(scrollbutton-up),
.menupopup-arrowscrollbox::part(scrollbutton-down) {
    visibility: collapse;
}

/* hide tab bar's arrow buttons and spacers */
#tabbrowser-arrowscrollbox::part(scrollbutton-up),
#tabbrowser-arrowscrollbox::part(scrollbutton-down),
#tabbrowser-arrowscrollbox::part(overflow-start-indicator),
#tabbrowser-arrowscrollbox::part(overflow-end-indicator) {
    visibility: collapse;
}

/* when drag mode is enabled. this enables the tab shadows to draw onto the drag space. */
:root[sizemode="normal"] #TabsToolbar > .toolbar-items #tabbrowser-arrowscrollbox::part(scrollbox) {
    min-height: calc(var(--min-tab-height) + var(--space-above-tabbar));
    padding-block-start: var(--space-above-tabbar);
}

/* protections popup panel's arrow style */
#protections-popup[mainviewshowing][side="top"]::part(arrow) {
    fill: var(--protection-header-arrow-color);
    stroke: var(--protection-header-arrow-color) !important;
}

/* other panel arrows */
:is(panel, menupopup)::part(arrow) {
    stroke: var(--arrowpanel-background);
}

@-moz-document url(chrome://browser/content/browser.xhtml)
{
    :is(panel, menupopup)::part(arrow) {
        display: -moz-inline-box;
    }

    :is(panel, menupopup)[side="top"]::part(arrow) {
        margin-bottom: -4px;
    }
}

#identity-icon {
    list-style-image: var(--default-identity-icon);
}

/* dropmarkers and other select/menulist stuff */
@-moz-document url(chrome://browser/content/browser.xhtml),
    url("chrome://mozapps/content/handling/permissionDialog.xhtml"),
    url("chrome://mozapps/content/handling/appChooser.xhtml"),
    url-prefix("chrome://global/content/print.html"),
    url("chrome://browser/content/places/bookmarkProperties.xhtml"),
    url("chrome://browser/content/places/bookmarkProperties2.xhtml")
{
    menulist:not([native]) {
        padding-inline: 6px;
    }

    :is(panel, dialog) menulist::part(dropmarker-icon) {
        appearance: none;
        list-style-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 16 16'><path fill='context-fill' fill-opacity='context-fill-opacity' d='M7.9 16.3c-.3 0-.6-.1-.8-.4l-4-4.8c-.2-.3-.3-.5-.1-.8.1-.3.5-.3.9-.3h8c.4 0 .7 0 .9.3.2.4.1.6-.1.9l-4 4.8c-.2.3-.5.3-.8.3zM7.8 0c.3 0 .6.1.7.4L12.4 5c.2.3.3.4.1.7-.1.4-.5.3-.8.3H3.9c-.4 0-.8.1-.9-.2-.2-.4-.1-.6.1-.9L7 .3c.2-.3.5-.3.8-.3z'/></svg>");
        margin-block: 0 !important;
        width: 10px !important;
        fill-opacity: 0.6;
    }

    :is(panel, dialog) menulist:is(:hover)::part(dropmarker-icon) {
        fill-opacity: 0.8;
    }

    :is(panel, dialog) menulist:is(:focus-visible, :hover:active, [open="true"])::part(dropmarker-icon) {
        fill-opacity: 1;
    }

    :is(panel, dialog) menulist::part(dropmarker) {
        margin-inline-start: 6px;
    }

    :is(panel, dialog) menulist::part(icon),
    :is(panel, dialog) menulist::part(dropmarker),
    :is(panel, dialog) menulist::part(dropmarker-icon) {
        -moz-context-properties: fill, fill-opacity;
    }

    :is(panel, dialog) menulist::part(label) {
        font-weight: normal;
    }

    menulist::part(label) {
        appearance: none;
        margin-block: 0;
    }

    #editBMPanel_folderMenuList::part(icon) {
        margin-inline: 3px;
    }
}

/* proton stuff */
.subviewbutton > menupopup::part(innerbox) {
    border-radius: 5px;
}

.menu-text,
.menu-iconic-text {
    padding-block: 0;
}

/* prevent hiding the close button when audio is playing. undoes an irritating rule in the proton update */
#navigator-toolbox:not(:hover)
    .tab-icon-overlay:not([pinned], [sharing], [crashed]):is([soundplaying], [muted], [activemedia-blocked]),
#navigator-toolbox:hover
    .tab-icon-stack:not([pinned], [sharing], [crashed]):is([soundplaying], [muted], [activemedia-blocked])
    > :not(.tab-icon-overlay) {
    opacity: revert;
}

#toolbar-menubar:not(:hover)
    + #TabsToolbar:not(:hover)
    .tab-icon-overlay:not([pinned], [sharing], [crashed]):is([soundplaying], [muted], [activemedia-blocked]),
:is(#toolbar-menubar:hover + #TabsToolbar, #TabsToolbar:hover)
    .tab-icon-stack:not([pinned], [sharing], [crashed]):is([soundplaying], [muted], [activemedia-blocked])
    > :not(.tab-icon-overlay) {
    opacity: revert;
}

/* revert proton changes */
.browserContainer > findbar {
    padding: 0;
}

.findbar-container {
    padding-block: 4px;
    padding-inline: 8px;
}

.findbar-find-previous,
.findbar-find-next {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid ThreeDShadow;
    border-inline-start: none;
    border-radius: 0;
}

.findbar-find-previous > .toolbarbutton-icon,
.findbar-find-next > .toolbarbutton-icon {
    padding: 0;
}

.findbar-find-previous {
    margin-inline-start: 0;
}

.findbar-find-next {
    border-start-end-radius: 0;
    border-end-end-radius: 0;
    margin-inline-end: 0;
}
