/* remove line under navigation toolbar */
#navigator-toolbox:-moz-lwtheme,
:root:not([sizemode="normal"]) #navigator-toolbox {
    border: none !important;
}

/* fix a silly bug */
#mainPopupSet {
    height: 0;
}

/* makes the flexible space in toolbar customization way smaller */
toolbarpaletteitem[place="toolbar"][id^="wrapper-customizableui-special-spring"],
toolbarspring {
    max-width: none !important;
    -moz-box-flex: 1 !important;
}

/* toolbar button badges */
:is(#nav-bar-customization-target, #widget-overflow)
    :is(toolbarbutton, toolbaritem):not([attention])
    .toolbarbutton-badge {
    background-color: var(--badge-color-light) !important;
    color: var(--toolbar-color, currentColor) !important;
    box-shadow: 0 1px 1px -1px hsla(0, 0%, 100%, 0.3) inset,
        0 -1px 1px -1px hsla(0, 0%, 0%, 0.5) inset, 0 1px 1px hsla(240, 3%, 12%, 0.15),
        0 1px 3px hsla(240, 3%, 12%, 0.2) !important;
    min-width: 11px !important;
    height: 11px !important;
    vertical-align: center !important;
    font-size: 9px !important;
    font-weight: 600 !important;
    line-height: 10px !important;
    filter: none !important;
}

#downloads-button[attention] .toolbarbutton-badge {
    margin-right: -5.5px !important;
    margin-top: -5.5px !important;
    width: 10px !important;
    height: 10px !important;
    box-shadow: none !important;
    background-image: url(chrome://userchrome/content/devtools/error.svg) !important;
    background-size: contain !important;
    background-position: center;
    background-repeat: no-repeat;
}

#downloads-button[attention="warning"] .toolbarbutton-badge {
    fill: hsl(44, 95%, 60%) !important;
    background-color: hsl(32, 52%, 35%) !important;
}

#downloads-button[attention="severe"] .toolbarbutton-badge {
    fill: hsl(358, 86%, 63%) !important;
    background-color: hsl(354, 69%, 30%) !important;
}

toolbar .toolbaritem-combined-buttons.chromeclass-toolbar-additional {
    margin-inline: 0 !important;
}

toolbar :not(toolbarpaletteitem) > .toolbaritem-combined-buttons.chromeclass-toolbar-additional {
    margin-inline: 0 !important;
    max-height: calc(2 * var(--toolbarbutton-inner-padding) + 16px) !important;
    margin-block: calc(
        (var(--urlbar-container-height) - calc(2 * var(--toolbarbutton-inner-padding) + 16px)) / 2
    );
}

toolbar .toolbaritem-combined-buttons.chromeclass-toolbar-additional:not(:hover) > separator {
    content: "";
    display: -moz-box;
    width: 0.67px !important;
    height: 20px !important;
    margin-inline-end: -0.67px !important;
    background-image: linear-gradient(currentColor 0, currentColor 100%);
    background-position: center;
    background-repeat: no-repeat;
    background-size: 1px 20px !important;
    opacity: 0.2;
}

toolbar .toolbarbutton-combined-buttons-dropmarker {
    min-height: calc(2 * var(--toolbarbutton-inner-padding) + 16px) !important;
}

toolbar .toolbarbutton-combined-buttons-dropmarker > .toolbarbutton-icon {
    padding-inline: 2px !important;
    padding-block: 2px !important;
    height: 20px !important;
    width: 16px !important;
}

toolbar #edit-controls > #cut-button,
toolbar #profiler-button > #profiler-button-button {
    padding-left: 2px !important;
}

toolbar #edit-controls > #paste-button,
toolbar #profiler-button > #profiler-button-dropmarker {
    padding-right: 2px !important;
}

toolbar #zoom-controls > :is(#zoom-out-button, #zoom-in-button) {
    min-height: calc(2 * var(--toolbarbutton-inner-padding) + 16px) !important;
    width: unset !important;
    padding: 0 !important;
    padding-inline: 2px !important;
}

toolbar #zoom-controls > :is(#zoom-out-button, #zoom-in-button) > .toolbarbutton-icon {
    height: 20px !important;
    width: 20px !important;
    padding: 4px !important;
}

toolbar #zoom-controls > #zoom-reset-button {
    min-height: calc(2 * var(--toolbarbutton-inner-padding) + 16px) !important;
}

toolbar
    #zoom-controls
    > #zoom-reset-button:not([disabled]):is(:hover, :focus)
    > .toolbarbutton-text {
    border-color: transparent;
}

toolbar #zoom-controls > #zoom-reset-button > .toolbarbutton-text {
    height: 20px !important;
    min-height: 20px !important;
    font-size: 0.98em;
    padding-block: 1px !important;
    background: hsla(0, 0%, 100%, 0.045);
    border: 1px solid var(--toolbarbutton-hover-background);
    border-radius: 10px !important;
}

toolbar #zoom-controls separator {
    display: none !important;
}

#back-button,
#forward-button,
#stop-reload-button {
    appearance: none !important;
    margin: 0 !important;
    padding: 0 var(--toolbarbutton-outer-padding) !important;
    -moz-box-pack: center !important;
}

:root:not([customizing]) #stop-reload-button > .toolbarbutton-1 {
    opacity: 1 !important;
}

:root:not([customizing])
    #stop-reload-button
    > .toolbarbutton-1:not([checked], [open], :active):hover
    > .toolbarbutton-icon {
    background-color: var(--toolbarbutton-hover-background);
}

:root:not([customizing])
    #stop-reload-button
    > .toolbarbutton-1:is(:focus-visible, [checked="true"]):not([open], :hover, :active)
    > .toolbarbutton-icon {
    background-color: var(--toolbarbutton-checked-background);
}

:root:not([customizing])
    #stop-reload-button
    > .toolbarbutton-1:is([open], [checked], :hover:active)
    > .toolbarbutton-icon {
    background-color: var(--toolbarbutton-active-background);
}

/* fix a little visual bug (maybe related to window scaling) where the stop button appears to move half a pixel to the left between animations.
this is because the reload button is replaced with a step animation for a few moments, and the step animation is then replaced with a static stop icon.
the stop icon sticks around until the page finishes loading, then it's hidden again and the step animation returns and plays in reverse.
unfortunately the way the static icon is rendered is not identical to the step animation for every given scaling factor.
to fix this we can just replace the static icon's path entirely with a path pulled directly from the step animation.
i haven't tested this on every scaling factor, if it makes things worse on your setup then just delete or override this. */
#stop-button .toolbarbutton-icon {
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='context-fill' fill-opacity='context-fill-opacity'><path d='M10.414 10l5.293-5.293a1 1 0 00-1.414-1.414L9 8.586 3.707 3.293a1 1 0 00-1.414 1.414L7.586 10l-5.293 5.293a1 1 0 101.414 1.414L9 11.414l5.293 5.293a1 1 0 001.414-1.414z'/></svg>") !important;
    background-repeat: no-repeat;
    background-position: left 5px center;
    list-style-image: none;
}

#nav-bar[brighttext] #panic-button[open] {
    fill: var(--warning-color) !important;
}

#nav-bar-customization-target {
    padding-inline-start: var(--toolbarbutton-outer-padding) !important;
}

#TabsToolbar-customization-target > #back-button {
    margin-inline-start: 2px !important;
}

:root:not([uidensity="compact"])
    :is(#nav-bar-customization-target, #TabsToolbar-customization-target)
    > :is(#stop-reload-button, #wrapper-stop-reload-button) {
    margin-inline: -2px !important;
}

#stop-reload-button {
    pointer-events: none !important;
}

#stop-reload-button > * {
    pointer-events: auto !important;
}

/* navbar shadow */
#navigator-toolbox {
    box-shadow: 0px 0px 8px -5px hsla(240, 4%, 0%, 0.5), 0px 0px 15px 0px hsla(0, 0%, 0%, 0.2) !important;
}

#nav-bar-customization-target {
    overflow: visible !important;
}

toolbar .toolbarbutton-1:not([disabled])[open]:hover > .toolbarbutton-icon {
    background-color: var(--toolbarbutton-active-background) !important;
}

#PersonalToolbar
    .toolbarbutton-1:is(:focus-visible, [checked="true"]):not([disabled], [open], :hover, :active),
toolbarbutton.bookmark-item:not(.subviewbutton):is(:focus-visible, [checked="true"]):not([disabled], [open], :hover, :active),
toolbar
    .toolbarbutton-1:is(:focus-visible, [checked="true"]):not([disabled], [open], :hover, :active)
    > :is(.toolbarbutton-icon, .toolbarbutton-text, .toolbarbutton-badge-stack) {
    background-color: var(--toolbarbutton-checked-background) !important;
    transition: none !important;
}

toolbar .toolbarbutton-1:not([disabled])[checked]:hover > .toolbarbutton-icon {
    background-color: var(--toolbarbutton-hover-background) !important;
}

#navigator-toolbox {
    z-index: 2 !important;
}

#nav-bar {
    z-index: 11 !important;
}

/* fullscreen button */
#fullscreen-button .toolbarbutton-icon {
    list-style-image: url(chrome://userchrome/content/skin/fullscreen.svg) !important;
}

#fullscreen-button[checked="true"] .toolbarbutton-icon {
    list-style-image: url(chrome://userchrome/content/skin/fullscreen-exit.svg) !important;
}

#fullscreen-button[checked="true"]:hover .toolbarbutton-icon {
    background-color: var(--toolbarbutton-hover-background) !important;
}

#fullscreen-button[checked="true"]:hover:active .toolbarbutton-icon {
    background-color: var(--toolbarbutton-active-background) !important;
}

#navigator-toolbox,
#navigator-toolbox > * {
    width: -moz-available;
}

/* proton notifications */
@media (-moz-proton) {
    #navigator-toolbox > :is(legacy-stack, .notificationbox-stack),
    #navigator-toolbox > named-deck > :is(legacy-stack, .notificationbox-stack),
    #navigator-toolbox > named-deck {
        display: flex !important;
        position: absolute !important;
        width: unset !important;
        border-bottom-right-radius: 4px !important;
        max-height: 74px !important;
    }

    #navigator-toolbox notification {
        width: -moz-fit-content !important;
        display: flex !important;
        overflow: hidden !important;
        border: none !important;
        transition: margin-top 300ms var(--animation-easing-function),
            opacity 300ms var(--animation-easing-function) !important;
    }

    #navigator-toolbox notification .messageText {
        display: inline-block !important;
        overflow: hidden !important;
        white-space: nowrap !important;
        text-overflow: ellipsis !important;
    }

    #navigator-toolbox notification .messageImage {
        min-width: 24px !important;
    }

    #navigator-toolbox notification .notification-button {
        margin-inline: 4px 0 !important;
    }

    #navigator-toolbox notification .close-icon {
        background: none !important;
        width: 40px !important;
        height: 40px !important;
    }

    #navigator-toolbox notification .close-icon .toolbarbutton-icon {
        border-radius: var(--toolbarbutton-border-radius);
    }

    #navigator-toolbox notification .close-icon:hover .toolbarbutton-icon {
        background-color: color-mix(in srgb, currentColor 10%, transparent);
    }

    #navigator-toolbox notification .close-icon:hover:active .toolbarbutton-icon {
        background-color: color-mix(in srgb, currentColor 20%, transparent);
    }

    #navigator-toolbox notification[type="info"] .text-link {
        color: var(--toolbarbutton-icon-fill-attention) !important;
    }

    #navigator-toolbox notification[type="critical"] .text-link {
        color: black !important;
    }

    #navigator-toolbox notification[type="info"] {
        --notification-background: var(--arrowpanel-background) !important;
    }

    #navigator-toolbox notification[type="critical"] {
        --notification-background: hsl(350.5, 100%, 50%) !important;
        --notification-text: black !important;
    }
}
